Dynamic calibration of agent based models using data
assimilation
Jonathan A. Ward, Andrew J. Evans and Nicolas S. Malleson
Article citation details
R. Soc. open sci. 3: 150703.
http://dx.doi.org/10.1098/rsos.150703
Review timeline
Original submission: 19 December 2015 Note: Reports are unedited and appear as
Revised submission: 11 March 2016 submitted by the referee. The review history
Final acceptance: 11 March 2016 appears in chronological order.
Review History
label_version_1
RSOS-150703.R0 (Original submission)
label_author_1
Review form: Reviewer 1 (David Kelly)
Is the manuscript scientifically sound in its present form?
Yes
Are the interpretations and conclusions justified by the results?
Yes
Is the language acceptable?
Yes
Is it clear how to access all supporting data?
Yes
Do you have any ethical concerns with this paper?
No
© 2016 The Authors. Published by the Royal Society under the terms of the Creative Commons
Attribution License http://creativecommons.org/licenses/by/4.0/, which permits unrestricted use,
provided the original author and source are credited
2
Have you any concerns about statistical analyses in this paper?
No
Recommendation?
label_recommendation_1
Accept with minor revision (please list in comments)
Comments to the Author(s)
label_comment_1
See Appendix A.
label_author_2
Review form: Reviewer 2 (Sarah Wise)
Is the manuscript scientifically sound in its present form?
Yes
Are the interpretations and conclusions justified by the results?
Yes
Is the language acceptable?
Yes
Is it clear how to access all supporting data?
I assume that the footfall data, if available, would be made available in a repository included with
the paper. This would be entirely adequate for the purposes of reproduction, in the mind of this
reviewer.
Do you have any ethical concerns with this paper?
No
Have you any concerns about statistical analyses in this paper?
I do not feel qualified to assess the statistics
Recommendation?
label_recommendation_2
Accept as is
Comments to the Author(s)
label_comment_2
There are a small number of extremely minor typographic errors, a few of which I include below.
My only other question deals with a point made on page 5 about the use of Kalman filters as
applied to linear systems. Considering how often ABM is applied to nonlinear systems, are there
non-linear substitutes that other researchers could fit into the place of Kalman filters? As a less
statistically-inclined researcher, I was curious, I offer no particular suggestions, but would be
especially impressed if it was possible to extend the method to such dynamics. Overall, I found
the paper well-structured, well documented, and very impressive. I recommend it for
publication.
pg 2 line 39 - “agreegated” versus “aggregated”
pg 3 line 18 “we will assume that for the models of interest X := R^n. instead?”
pg 3 line 43 - “corresponding to the state of the system at time tk + 1 correct?”
pg 5 line 36 - “expresions”
pg 7 line 20 - “varainces”
3
label_end_comment
Decision letter (RSOS-150703)
25-Feb-2016
Dear Dr Ward
On behalf of the Editors, I am pleased to inform you that your Manuscript RSOS-150703 entitled
"Dynamic calibration of agent based models using data assimilation" has been accepted for
publication in Royal Society Open Science subject to minor revision in accordance with the
referee suggestions. Please find the referees' comments at the end of this email.
The reviewers and handling editors have recommended publication, but also suggest some minor
revisions to your manuscript. Therefore, I invite you to respond to the comments and revise your
manuscript.
• Ethics statement
If your study uses humans or animals please include details of the ethical approval received,
including the name of the committee that granted approval. For human studies please also detail
whether informed consent was obtained. For field studies on animals please include details of all
permissions, licences and/or approvals granted to carry out the fieldwork.
• Data accessibility
It is a condition of publication that all supporting data are made available either as
supplementary information or preferably in a suitable permanent repository. The data
accessibility section should state where the article's supporting data can be accessed. This section
should also include details, where possible of where to access other relevant research materials
such as statistical tools, protocols, software etc can be accessed. If the data has been deposited in
an external repository this section should list the database, accession number and link to the DOI
for all data from the article that has been made publicly available. Data sets that have been
deposited in an external repository and have a DOI should also be appropriately cited in the
manuscript and included in the reference list.
If you wish to submit your supporting data or code to Dryad (http://datadryad.org/), or modify
your current submission to dryad, please use the following link:
http://datadryad.org/submit?journalID=RSOS&manu=RSOS-150703
• Competing interests
Please declare any financial or non-financial competing interests, or state that you have no
competing interests.
• Authors’ contributions
All submissions, other than those with a single author, must include an Authors’ Contributions
section which individually lists the specific contribution of each author. The list of Authors
should meet all of the following criteria; 1) substantial contributions to conception and design, or
acquisition of data, or analysis and interpretation of data; 2) drafting the article or revising it
critically for important intellectual content; and 3) final approval of the version to be published.
All contributors who do not meet all of these criteria should be included in the
acknowledgements.
We suggest the following format:
AB carried out the molecular lab work, participated in data analysis, carried out sequence
alignments, participated in the design of the study and drafted the manuscript; CD carried out
the statistical analyses; EF collected field data; GH conceived of the study, designed the study,
4
coordinated the study and helped draft the manuscript. All authors gave final approval for
publication.
• Acknowledgements
Please acknowledge anyone who contributed to the study but did not meet the authorship
criteria.
• Funding statement
Please list the source of funding for each author.
Because the schedule for publication is very tight, it is a condition of publication that you submit
the revised version of your manuscript within 7 days (i.e. by the 05-Mar-2016). If you do not think
you will be able to meet this date please let me know immediately.
To revise your manuscript, log into https://mc.manuscriptcentral.com/rsos and enter your
Author Centre, where you will find your manuscript title listed under "Manuscripts with
Decisions". Under "Actions," click on "Create a Revision." You will be unable to make your
revisions on the originally submitted version of the manuscript. Instead, revise your manuscript
and upload a new version through your Author Centre.
When submitting your revised manuscript, you will be able to respond to the comments made by
the referees and upload a file "Response to Referees" in "Section 6 - File Upload". You can use this
to document any changes you make to the original manuscript. In order to expedite the
processing of the revised manuscript, please be as specific as possible in your response to the
referees.
When uploading your revised files please make sure that you have:
1) A text file of the manuscript (tex, txt, rtf, docx or doc), references, tables (including captions)
and figure captions. Do not upload a PDF as your "Main Document".
2) A separate electronic file of each figure (EPS or print-quality PDF preferred (either format
should be produced directly from original creation package), or original software format)
3) Included a 100 word media summary of your paper when requested at submission. Please
ensure you have entered correct contact details (email, institution and telephone) in your user
account
4) Included the raw data to support the claims made in your paper. You can either include your
data as electronic supplementary material or upload to a repository and include the relevant doi
within your manuscript
5) Included your supplementary files in a format you are happy with (no line numbers,
vancouver referencing, track changes removed etc) as these files will NOT be edited in
production
Once again, thank you for submitting your manuscript to Royal Society Open Science and I look
forward to receiving your revision. If you have any questions at all, please do not hesitate to get
in touch.
Best wishes
Emilie Aime
Senior Publishing Editor, Royal Society Open Science
on behalf of Des Higham
Subject Editor, Royal Society Open Science
openscience@royalsociety.org
5
Associate Editor Comments to Author ( Professor Danica Vukadinovic Greetham):
Associate Editor: 1
Comments to the Author:
Dear Dr Ward,
I am pleased to tell you that your work has now been accepted for publication subject to minor
revisions as detailed in the reviewers' comments below.
Please include a list of changes against each point raised when you
submit the final version of the manuscript. Your final version is due by 17 March 2016.
Comments from Reviewer 1
There are a small number of extremely minor typographic errors, a few of which I include below.
My only other question deals with a point made on page 5 about the use of Kalman filters as
applied to linear systems. Considering how often ABM is applied to nonlinear systems, are there
non-linear substitutes that other researchers could fit into the place of Kalman filters? As a less
statistically-inclined researcher, I was curious, I offer no particular suggestions, but would be
especially impressed if it was possible to extend the method to such dynamics. Overall, I found
the paper well-structured, well documented, and very impressive. I recommend it for
publication.
pg 2 line 39 - “agreegated” versus “aggregated”
pg 3 line 18 “we will assume that for the models of interest X := R^n. instead?”
pg 3 line 43 - “corresponding to the state of the system at time tk + 1 correct?”
pg 5 line 36 - “expresions”
pg 7 line 20 - “varainces”
Comments from Reviewer 2
In this article, the authors propose the application of data assimilation techniques to agent based
models (ABMs). The authors illustrate their technique by applying the ensemble Kalman
&#12;lter (EnKF) to a scalar stochastic model described by a simple master equation. The authors
subsequently apply the EnKF to real-world data, with the aim of estimating the number of people
on a street in Leeds via footfall counts on a pedestrian high street. The authors develop a simple
ABM to dynamically represent the population of shoppers and workers that contribute to footfall
statistics, the model is a variant of an SIR model.
I have a few comments that are included below.
1. Can the authors comment on the choice of EnKF for the data assimilation method?
It is of course natural for nonlinear stochastic models, but there are other natural choices like the
extended and unscented kalman fi&#12;lters.
2. pg 4, last line: Is it accurate to call EnKF the minimal variance estimator for linear models? This
is true for N->\infty, I'm not aware of such a claim for &#12;fixed N though.
3. pg 7, towards the bottom of page: you state that the point of data assimilation is illustrated by
your scalar example. I would argue that the true power of data assimilation comes from problems
with sparse observations. Maybe just re&#12;ne the statement to, 'for scalar models, the point of
data assimilation is ...'.
4. For the simple example, how is the ensemble initialized? (I guess using the stationary
dynamics) How many ensemble members? (apologies if i missed this).
5. Last paragraph of section 4b: I may have misinterpreted this part, but it seems like you are
saying that the EnKF is not working well as it is not fi&#12;nding the true parameter values? I
would argue that EnKF is doing a reasonable job of representing the posterior (as well as EnKF
can possibly hope to). As the authors point out, in the state space (x, \alpha , \beta &#12;), there
will be a subspace of value of &#11;\alpha, \beta for which the stationary statistics are
unchanged (lines of constant ratio). This suggests that the posterior will be constant along these
lines (at least in the long run). Since EnKF ensembles tend to clump up into Gaussians, the
6
ensemble will fi&#12;nd the correct `ratio-line', but of will not be uniformly distributed across
that line as the true posterior should be. This is exactly what the authors fi&#12;nd, the correct
ratio but the wrong parameters (and falsely con&#12;dent about them too).
This is an EnKF problem - particle filters would be better at capturing the true
uncertainty.
6. Section 8: Does the assimilation fail if a lot less are used? If the stationary statistics are quasi-
Gaussian (as in the simple example) I would expect that you can aff&#11;ord a much smaller N.
The parameters may complicate things.
7. Section 8a: I found this section hard to follow. Is the main problem that the parameters are not
changing on an hourly basis, but only on a daily basis? If this 1 is the problem, why don't you
simply incorporate this into your model? Would also appreciate a bit more depth about the
particle fi&#12;ltering ideas, as this seems like an unusual type of particle fi&#12;lter.
And some corrections/minutiae:
1. pg 3, line 12: `instead?' looks like it escaped the &#12;nal edit.
2. pg 3, line -14: 'correct?' as above.
3. pg 3, line -16: \mathcal R should be \mathcal T ?
4. page 7, line 11: `varainces'
5. page 7, line -14: 'quick'
6. page 4, line -1: 'additative'
The article is well written, the ideas are clear and the application of data assimilation
methods appears sound. In the interest of full disclosure, my background in data assimilation is
limited to the theory of fi&#12;ltering and the application to geophysical models.
Thus I have limited ability to judge the article's scientifi&#12;c merit regarding the modeling
of footfalls in Leeds. In spite of this, I found the motivations clear and the models well
introduced and very easy to understand. I would be happy to recommend the paper
for publication in Royal Society Open Science, as I believe it to be a skillful application
of data assimilation to a novel scientifi&#12;c area.
Reviewer comments to Author:
Reviewer: 1
Comments to the Author(s)
There are a small number of extremely minor typographic errors, a few of which I include below.
My only other question deals with a point made on page 5 about the use of Kalman filters as
applied to linear systems. Considering how often ABM is applied to nonlinear systems, are there
non-linear substitutes that other researchers could fit into the place of Kalman filters? As a less
statistically-inclined researcher, I was curious, I offer no particular suggestions, but would be
especially impressed if it was possible to extend the method to such dynamics. Overall, I found
the paper well-structured, well documented, and very impressive. I recommend it for
publication.
pg 2 line 39 - “agreegated” versus “aggregated”
pg 3 line 18 “we will assume that for the models of interest X := R^n. instead?”
pg 3 line 43 - “corresponding to the state of the system at time tk + 1 correct?”
pg 5 line 36 - “expresions”
pg 7 line 20 - “varainces”
Reviewer: 2
Comments to the Author(s)
See attached file
7
Author's Response to Decision Letter for (RSOS-150703)
Dear Sir or Madam,
Please find attached a revised manuscript in response to reviewers' comments for the article
"Dynamic calibration of agent based models using data assimilation", ID RSOS-150703.
Firstly we would like to thank the reviewers for their positive and constructive comments. We
have incorporated the suggested changes in accordance with the conditions for publication.
In response to the detailed comments:
Reviewer 1.
Thanks again for your comments. We have fixed a number of minor typos, including those
suggested. Concerning the reviewer's comment:
"Considering how often ABM is applied to nonlinear systems, are there non-linear substitutes
that other researchers could fit into the place of Kalman filters?"
This point is what motivated us to use the ensemble Kalman filter, which is appropriate for
nonlinear dynamical models such as ABMs. It also a class of "reduced-rank" filter that allows for
relatively efficient computation, in comparison to other nonlinear filtering methods (further
discussion below in response to Reviewer 2). To make this point clearer, we have added the
following sentence to the introduction:
"We focus on using the ensemble Kalman filter (EnKF), since ABMs are often highly nonlinear
and can be computationally intensive."
Reviewer 2.
Thanks again for your comments. As noted above, we have fixed a number of minor typos,
including those suggested.
Concerning the specific numbered comments:
1. Our motivation for using the ensemble Kalman filter (EnKF) is three-fold. Firstly, the ensemble
Kalman filter is relatively simple to implement and can be done so within a very general
modelling framework. This is important because one of our main goals is to make data
assimilation accessible to agent based modelling practitioners. Secondly, as the reviewer also
notes, it gives reasonable results with relatively small ensemble sizes. This is an important feature
since many ABMs are computationally intensive. Thirdly, the EnKF does not really on gradient
methods. This is particularly important for ABM since they are typically non-smooth.
We have incorporated this point into the introduction with the additional sentence:
"We focus on using the ensemble Kalman filter (EnKF), since ABMs are often highly nonlinear
and can be computationally intensive."
2. Thank you for pointing this out, we have corrected this statement as follows:
"for the case of a linear model it provides the minimum variance as N-> infinity"
8
3. We have refined the statement in line with the suggestion to try to avoid confusion:
"This illustrates a key point. Knowledge of the underlying process..."
4. We have revised the description of the initial conditions of the box model EnKF in section 4(a)
in order to make them clearer:
"For the EnKF, we initialised each of the $N=100$ ensemble simulations using a rounded normal
distribution with mean 200 and variance 200, as we did for the ground truth data, and used the
corresponding rate parameters $\alpha\approx52.52$ and $\beta\approx0.2580$."
5. We agree with the reviewer's comments and have tried to incorporate them in a way that fits
with the rest of the text. However, the point we were trying to make is that understanding the
relationship between model parameters and model dynamics is important if we are to correctly
interpret the results of sequential parameter estimation when using the EnKF. We have edited the
paragraph as follows to make this clearer:
"From section 4 we know that it is this ratio that governs the stationary statistics and so in this
sense the EnKF has found the correct parametric representation of the synthetic data. This
observation shows that understanding the relationship between model parameters and model
dynamics is important if we are to correctly interpret the results of sequential parameter
estimation when using the EnKF."
6. If we use a smaller ensemble size N, then the effectiveness of the EnKF is strongly dependent
on the specific initial conditions. From our experimentation with this, we have found that we get
"better" results (specifically smaller RMSE between forecast and observation) with a larger value
of N. However, this naturally takes more computational time, and this may not be feasible with
more complex ABMs. We have included a discussion of this point in the second to last paragraph
of section 8.
"We also repeated the training and testing process with ensemble sizes of N = 10 and N = 1000,
which resulted in RMSE scores of 1141.5012 and 457.3 respectively. Thus using an ensemble size
of N = 100 produces considerably better forecasts than using N = 10, but the gains of going to N =
1000 are not as substantial. This demonstrates an advantage of the EnKF over particle filtering—
relatively small ensemble sizes give reasonable results."
7. We have edited section 8(a) in attempt to make it clearer. We have included the following
sentence that we hope makes the motivation clearer:
"Since there is a weak correlation between the peak footfall counts on consecutive days, we
suppose that the rate parameters, which affect the peak count, are effectively sampled
independently each day. Thus the challenge is to determine, as soon as possible, what rate
parameter best fits each day’s data."
We then go on to describe how we have adapted the EnKF algorithm to incorporate a method of
trying to estimate what rate parameter best fits the data as each day progresses. We do this by
updating weights for each ensemble member. The update method is the same as how you would
update the weights in a particle filter, but here our goal is different - we wish to select the best
rate parameters from the ensemble. We have tried to make this point clearer by including the
following discussion:
9
"The weights tell us each hour which ensemble members, and hence the corresponding rate
parameters, are the most likely candidates for the current day’s observations. This process of
updating weights is similar to a particle filter. We use an ensemble size of N = 100 and the spread
in the normalised weights typically vanishes quickly, giving a clear indication of which ensemble
member matches closest to the data. This effect would be undesirable in a particle filter and is
why they typically need large ensemble sizes in order to faithfully sample the posterior
distribution. In contrast, the reduction in the spread of weights is advantageous here."
We would like to thank both reviewers again for their commments and we hope they are satisfied
by our responses.
Kind regards,
Jonathan Ward, Andrew Evans, Nicholas Malleson
Appendix A
n this article, the authors propose the application of data assimilation techniques to
gent based models (ABMs). The authors illustrate their technique by applying the
nsemble Kalman filter (EnKF) to a scalar stochastic model described by a simple
master equation. The authors subsequently apply the EnKF to real-world data, with
he aim of estimating the number of people on a street in Leeds via footfall counts on
pedestrian high street. The authors develop a simple ABM to dynamically represent
he population of shoppers and workers that contribute to footfall statistics, the model
s a variant of an SIR model.
have a few comments that are included below.
1. Can the authors comment on the choice of EnKF for the data assimilation method?
It is of course natural for nonlinear stochastic models, but there are other natural
choices like the extended and unscented kalman filters.
2. pg 4, last line: Is it accurate to call EnKF the minimal variance estimator for
linear models? This is true for N <U+2192> 8, I’m not aware of such a claim for fixed
N though.
3. pg 7, towards the bottom of page: you state that the point of data assimilation
is illustrated by your scalar example. I would argue that the true power of data
assimilation comes from problems with sparce observations. Maybe just refine
the statement to, ’for scalar models, the point of data assimilation is ...’.
4. For the simple example, how is the ensemble initialized? (I guess using the sta-
tionary dynamics) How many ensemble members? (apologies if i missed this).
5. Last paragraph of section 4b: I may have misinterpreted this part, but it seems
like you are saying that the EnKF is not working well as it is not finding the
true parameter values? I would argue that EnKF is doing a reasonable job of
representing the posterior (as well as EnKF can possibly hope to). As the authors
point out, in the state space (x, a, ß), there will be a subspace of value of a, ß
for which the stationary statistics are unchanged (lines of constant ratio). This
suggests that the posterior will be constant along these lines (at least in the long
run). Since EnKF ensembles tend to clump up into Gaussians, the ensemble will
find the correct ‘ratio-line’, but of will not be uniformly distributed across that
line as the true posterior should be. This is exactly what the authors find, the
correct ratio but the wrong parameters (and falsely confident about them too).
This is an EnKF problem - particle filters would be better at capturing the true
uncertainty.
6. Section 8: Does the assimilation fail if a lot less are used? If the stationary
statistics are quasi-Gaussian (as in the simple example) I would expect that you
can afford a much smaller N . The parameters may complicate things.
7. Section 8a: I found this section hard to follow. Is the main problem that the
parameters are not changing on an hourly basis, but only on a daily basis? If this
1
is the problem, why don’t you simply incorporate this into your model? Would
also appreciate a bit more depth about the particle filtering ideas, as this seems
like an unusual type of particle filter.
And some corrections/minutiae:
1. pg 3, line 12: ‘instead?’ looks like it escaped the final edit.
2. pg 3, line -14: ’correct?’ as above.
3. pg 3, line -16: R should be T ?
4. page 7, line 11: ‘varainces’
5. page 7, line -14: ’quick’
6. page 4, line -1: ’additative’
The article is well written, the ideas are clear and the application of data assimilation
methods appears sound. In the interest of full disclosure, my background in data as-
imilation is limited to the theory of filtering and the application to geophysical models.
Thus I have limited ability to judge the article’s scientific merit regarding the modeling
f footfalls in Leeds. In spite of this, I found the motivations clear and the models well
ntroduced and very easy to understand. I would be happy to recommend the paper
or publication in Royal Society Open Science, as I believe it to be a skillful application
f data assimilation to a novel scientific area.
David Kelly,
Courant Institute of Mathematical
ciences,
New York University, New York, NY.
2
Society Open
